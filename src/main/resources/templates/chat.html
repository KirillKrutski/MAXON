<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="chat-container">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üí¨ –ß–∞—Ç—ã</h2>
            <div class="user-info">
                <span th:text="${username}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                <button onclick="logout()" class="btn-secondary">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="search-section">
            <input type="text" id="userSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..."
                   oninput="searchUsers(this.value)">
            <div id="searchResults" class="search-results"></div>
        </div>

        <!-- –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã -->
        <div class="requests-section">
            <h4>üì® –ó–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è</h4>
            <div id="friendRequests" class="requests-list"></div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
        <div class="contacts-section">
            <h3>üë• –ú–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
            <div id="contactsList" class="contacts-list">
                <div class="no-contacts">–ö–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
    <div class="chat-area">
        <div class="no-chat-selected">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç!</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</p>
            <p><em>–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã</em></p>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞ (–ø–æ–∫–∞ —Å–∫—Ä—ã—Ç–∞) -->
        <div id="activeChat" class="chat-window hidden">
            <div class="chat-header">
                <h3 id="chatTitle">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <div id="chatParticipants" class="chat-participants"></div>
            </div>

            <div id="messagesContainer" class="messages-container">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <div class="message-input">
                <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                <button id="sendMessageBtn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentUser = null;
    let currentChat = null;

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞...");
        loadUser();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    async function loadUser() {
        try {
            const response = await fetch('/api/user/current');
            if (response.ok) {
                currentUser = await response.json();
                console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:", currentUser.username);
                loadFriendRequests();
                loadContacts();
            } else {
                console.error("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
                window.location.href = '/';
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            window.location.href = '/';
        }
    }

    // ==================== –ü–û–ò–°–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ====================
    async function searchUsers(query) {
        const resultsContainer = document.getElementById('searchResults');

        if (!query || query.trim().length < 2) {
            resultsContainer.innerHTML = '';
            return;
        }

        console.log("üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", query);

        try {
            const response = await fetch(`/api/users/search?q=${encodeURIComponent(query)}`);
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
            }

            const users = await response.json();
            console.log("üìã –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", users.length);
            displaySearchResults(users);
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
            resultsContainer.innerHTML = '<div class="no-results">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>';
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
    function displaySearchResults(users) {
        const container = document.getElementById('searchResults');

        if (users.length === 0) {
            container.innerHTML = '<div class="no-results">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            return;
        }

        container.innerHTML = users.map(user => `
                <div class="search-result-item">
                    <div class="user-info">
                        <strong>üë§ ${user.username}</strong>
                        <span class="user-id">ID: ${user.id}</span>
                    </div>
                    <button class="btn-small send-request-btn"
                            onclick="sendFriendRequest(${user.id})"
                            title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è">
                        üì® –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            `).join('');
    }

    // ==================== –ó–ê–ü–†–û–°–´ –í –î–†–£–ó–¨–Ø ====================
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è
    async function sendFriendRequest(toUserId) {
        if (!currentUser) {
            alert('‚ùå –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã');
            return;
        }

        console.log("üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ID:", toUserId);

        try {
            const response = await fetch('/api/friend-request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `toUserId=${toUserId}`
            });

            const data = await response.json();
            console.log("üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

            if (data.success) {
                alert('‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
                document.getElementById('searchResults').innerHTML = '';
                document.getElementById('userSearch').value = '';
            } else {
                alert('‚ùå ' + data.message);
            }
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
            alert('üí• –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    async function loadFriendRequests() {
        try {
            const response = await fetch('/api/friend-requests/incoming');
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤');
            }

            const requests = await response.json();
            console.log("üì® –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤:", requests.length);
            displayFriendRequests(requests);
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:', error);
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    function displayFriendRequests(requests) {
        const container = document.getElementById('friendRequests');

        if (requests.length === 0) {
            container.innerHTML = '<div class="no-requests">üì≠ –ó–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç</div>';
            return;
        }

        container.innerHTML = requests.map(request => `
                <div class="friend-request-item">
                    <div class="request-info">
                        <strong>üë§ ${request.fromUsername}</strong>
                        <span>—Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã</span>
                    </div>
                    <div class="request-actions">
                        <button class="btn-small accept-btn"
                                onclick="acceptFriendRequest(${request.id})"
                                title="–ü—Ä–∏–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å">
                            ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                        </button>
                        <button class="btn-small reject-btn"
                                onclick="rejectFriendRequest(${request.id})"
                                title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å">
                            ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
    }

    // –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    async function acceptFriendRequest(requestId) {
        console.log("‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–∞ ID:", requestId);

        try {
            const response = await fetch(`/api/friend-requests/${requestId}/accept`, {
                method: 'POST'
            });

            const data = await response.json();

            if (data.success) {
                alert('‚úÖ –ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                loadFriendRequests();
                loadContacts();
            } else {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞: ' + data.message);
            }
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞:', error);
            alert('üí• –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }

    // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    async function rejectFriendRequest(requestId) {
        console.log("‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ ID:", requestId);

        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å?')) {
            return;
        }

        try {
            const response = await fetch(`/api/friend-requests/${requestId}/reject`, {
                method: 'POST'
            });

            const data = await response.json();

            if (data.success) {
                alert('‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω');
                loadFriendRequests();
            } else {
                alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞');
            }
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞:', error);
            alert('üí• –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }

    // ==================== –ö–û–ù–¢–ê–ö–¢–´ ====================
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    async function loadContacts() {
        try {
            const response = await fetch('/api/contacts');
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤');
            }

            const contacts = await response.json();
            console.log("üìû –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:", contacts.length);
            displayContacts(contacts);
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:', error);
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    function displayContacts(contacts) {
        const container = document.getElementById('contactsList');

        if (contacts.length === 0) {
            container.innerHTML = '<div class="no-contacts">üë• –ö–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            return;
        }

        container.innerHTML = contacts.map(contact => `
                <div class="contact-item" data-user-id="${contact.id}">
                    <div class="contact-avatar">üë§</div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.username}</div>
                        <div class="contact-status">üü¢ –í —Å–µ—Ç–∏</div>
                    </div>
                    <button class="btn-small start-chat-btn"
                            onclick="startChat(${contact.id}, '${contact.username}')"
                            title="–ù–∞—á–∞—Ç—å —á–∞—Ç">
                        üí¨ –ß–∞—Ç
                    </button>
                </div>
            `).join('');
    }

    // –ù–∞—á–∞–ª–æ —á–∞—Ç–∞
    function startChat(userId, username) {
        console.log("üí¨ –ù–∞—á–∞–ª–æ —á–∞—Ç–∞ —Å:", username, "ID:", userId);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞
        document.querySelector('.no-chat-selected').classList.add('hidden');
        document.getElementById('activeChat').classList.remove('hidden');

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
        document.getElementById('chatTitle').textContent = username;
        document.getElementById('chatParticipants').textContent = `–£—á–∞—Å—Ç–Ω–∏–∫–∏: ${username}`;

        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('messageInput').disabled = false;
        document.getElementById('sendMessageBtn').disabled = false;

        // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('messageInput').focus();

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ
        currentChat = {
            id: userId,
            name: username,
            isPrivate: true
        };

        // TODO: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
        loadChatMessages(userId);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)
    async function loadChatMessages(chatId) {
        console.log("üì® –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —á–∞—Ç–∞ ID:", chatId);
        // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
        document.getElementById('messagesContainer').innerHTML = `
                <div class="no-messages">
                    <p>üí¨ –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!</p>
                    <p><em>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</em></p>
                </div>
            `;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    async function sendMessage() {
        if (!currentChat || !currentUser) {
            alert('‚ùå –ß–∞—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω');
            return;
        }

        const messageInput = document.getElementById('messageInput');
        const content = messageInput.value.trim();

        if (!content) {
            return;
        }

        console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:", content);

        // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
        alert('üì§ –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');

        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        messageInput.value = '';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('messageInput')?.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
    document.getElementById('sendMessageBtn')?.addEventListener('click', sendMessage);

    // ==================== –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    async function logout() {
        console.log("üö™ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...");

        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
            return;
        }

        try {
            const response = await fetch('/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                }
            });

            console.log("‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω, —Å—Ç–∞—Ç—É—Å:", response.status);
            window.location.href = '/';
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
            window.location.href = '/';
        }
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
        if (currentUser) {
            loadFriendRequests();
            loadContacts();
        }
    }, 10000);
</script>
</body>
</html>